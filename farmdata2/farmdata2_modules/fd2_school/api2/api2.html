<html>
    <h1>Harvest Report</h1>
    <p>This page is a <em>mockup</em> of a simplified harvest report.</p>
    <hr>

    <style>
        [v-cloak] {
          display: none;
        }
      </style>

    <div id="app" v-cloak>
        
        <div class="input-group">
            <label for="title">Title:</label>
            <input type="text" id="title" name="title" v-model="reportTitle" placeholder="Enter report title">
        </div>

        <div class="input-group">
            <label for="crop">Crop:</label>
            <select id="crop" name="crop" v-model="reportCrop">
                <option v-for="crop in cropNames" :value="crop">{{crop}}</option>
            </select>
        </div>

        <div class="input-group">
            <label for="field">Field:</label>
            <select id="field" name="field" v-model="reportField">
                <option v-for="area in areaNames" :value="area">{{area}}</option>
            </select>
        </div>

        <div class="input-group">
            <label for="start-date">Start Date:</label>
            <input
                type="date"
                id="start-date"
                name="start-date"
                v-model="reportStartDate"
                :max="reportEndDate"
                min="2014-01-01"
            />
        </div>

        <div class="input-group">
            <label for="end-date">End Date:</label>
            <input type="date" id="end-date" name="end-date" v-model="reportEndDate" :min="reportStartDate" max="2022-01-01"/>
        </div>

        <div class="input-group">
            <button type="submit" @click='generateReport'>Generate Report</button>
        </div>

        <h1>{{ reportTitle ? reportTitle : "Mock Harvest Report" }}</h1>

        <h3>Details:</h3>
        <br>

        <ul>
            <li><strong>Farm:</strong> {{ reportFarm }}</li>
            <li><strong>User:</strong> {{ reportUser }}</li>
            <li><strong>Language:</strong> {{ reportLanguage }}</li>
            <br>
            <li><strong>Start:</strong> {{ reportStartDate }}</li>
            <li><strong>End:</strong> {{ reportEndDate }}</li>
            <li><strong>Crop:</strong> {{ reportCrop }}</li>
        </ul>

        <h3>Harvest Data</h3>

        <div v-if="harvestLogs.length > 0">
            <table border="1">
                <thead>
                    <tr>
                        <th>Row</th>
                        <th>Date</th>
                        <th>Area</th>
                        <th>Crop</th>
                        <th>Yield</th>
                        <th>Units</th>
                    </tr>
                </thead>
                <tbody>
                    <tr v-for="(log, index) in harvestLogs" :key="index">
                        <td>{{ index + 1 }}</td>
                        <td>{{log.date}}</td>
                        <td>{{log.area}}</td>
                        <td>{{log.crop}}</td>
                        <td>{{log.yield}}</td>
                        <td>{{log.units}}</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div v-else>
            <p>No matching records.</p>
        </div>
    

        <h3>Farmers</h3>
        <ul>
            <li v-for="name in names" :key="name">{{ name }}</li>
        </ul>
    </div>

    <script src="https://unpkg.com/vue@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        var vm = new Vue({
            el: '#app',
            data: {
                reportTitle: 'My Sample Harvest Report',
                reportStartDate: '2020-05-05',
                reportEndDate: '2020-05-15',
                reportCrop: 'Kale',
                reportField: 'Chuau-1',
                reportFarm: '',
                reportUser: '',
                reportLanguage: '',
                names: ["Joe", "Arun", "Ouwen", "Anh", "Sue"],
                fields: ['All', 'Chuau-1', 'SQ7'],
                harvestLogs: [],
                idToCropMap: new Map(),
                idToAreaMap: new Map()
            },
            created() {
                console.log("HarvestReport Vue instance created!");

                getIDToCropMap().then(theMap => {
                    this.idToCropMap = theMap;
                    console.log("Crop Map fetched:", this.idToCropMap);
                }).catch(error => {
                    console.log("Error occurred while fetching crop map:", error);
                });

                getIDToAreaMap().then(theMap => {
                    this.idToAreaMap = theMap;
                    console.log("Area Map fetched:", this.idToAreaMap);
                }).catch(error => {
                    console.log("Error occurred while fetching area map:", error);
                });
            },

            computed: {
                cropNames() {
                    return Array.from(this.idToCropMap.values());
                },
                areaNames() {
                    return Array.from(this.idToAreaMap.values()); 
                }
            },

            methods: {
                generateReport: function()  {

                    axios.get('/farm.json').then(response => {
                        
                        this.reportFarm = response.data.name || 'Unknown Farm';
                        this.reportUser = response.data.user.username || 'Unknown User';
                        this.reportLanguage = response.data.language || 'Unknown Language';

                        this.harvestLogs.push({
                            date: "2018-05-01", 
                            area: "Orion-3", 
                            crop: this.reportCrop, 
                            yield: 12, 
                            units: "Bunches"
                        });
                    })
                    .catch(error => {
                    console.log("Error Occurred");
                    console.log(error);
                    });
                    }
                } 
        });
        Vue.config.devtools = true;
    </script>


</html>


